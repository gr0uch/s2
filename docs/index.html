<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>s&sup2;</title>
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDQuMjMzMzMzMyA0LjIzMzMzMzMiPjxnPjxwYXRoIGZpbGw9IiMzZmI2OGIiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTAgMGg0LjIzM3Y0LjIzM2gtNC4yMzN6Ii8+PHBhdGggZD0iTTEuNDE2LjgzMXEtLjQwMy4zLS40MDMuNjQ2IDAgLjQ0NC4zMi40NDQuMTE0IDAgLjM2Mi0uMTk2dC40ODYtLjE5NnEuMjI3IDAgLjM2Ny4xMTkuMTQuMTE0LjE0LjMwNSAwIC4xODEtLjE4MS4zODItLjE4MS4xOTYtLjY0MS40NS0uNDYuMjQ4LS41ODQuMzMxLS4xMjQuMDg4LS4yMTIuMjEybC0uMDI2LS4wMzEuMDMxLS4wNjIuMDM2LS4wNzgtLjA4OC0uMTAzcS0uMDgzLS4wNzgtLjIyMi0uMDc4LS4yNTggMC0uNDA4LjI2OWwtLjAyNi4wMzEtLjAzMS0uMDMxcTAtLjA4My4yMzMtLjMyLjIzOC0uMjQzLjU2My0uMjQzLjI0MyAwIC40MjQuMTU1bC4wNDEuMDI2LjA3Mi0uMDQxcS4zNDYtLjE4MS40NDQtLjMzMS4wOTgtLjE1LjA5OC0uMzE1IDAtLjE4MS0uMTA5LS4yODQtLjEwMy0uMTA5LS4yNzQtLjEwOS0uMTI0IDAtLjM3Ny4xOTYtLjI0OC4xOTYtLjQ2LjE5Ni0uMTY1IDAtLjI4NC0uMTI5LS4xMTktLjEzNC0uMTE5LS4zMTUgMC0uMjU4LjIyNy0uNTE3LjIyNy0uMjU4LjgxNi0uNTY4LjI4OS0uMTU1LjQwMy0uMzI2bC4wMTYtLjAyMS4wMjEuMDQxLS4wOTMuMTI0LS4wODguMTI0cS4xNzEuMTQ1LjI3OS4xNDUuMTM0IDAgLjI4NC0uMTAzbC4wMjEuMDMxcTAgLjAyNi0uMjQzLjI0My0uMjM4LjIxMi0uMzcyLjIxMi0uMTI0IDAtLjQ0NC0uMjg0eiIgc3R5bGU9ImxpbmUtaGVpZ2h0OjEuMjU7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjpQYXJjaG1lbnQ7cGFpbnQtb3JkZXI6bm9ybWFsIiBmb250LXNpemU9IjEwLjU4MyIgZm9udC1mYW1pbHk9IlBhcmNobWVudCIgc3Ryb2tlPSIjZmZmIiBzdHJva2Utd2lkdGg9Ii4xMzIiIHN0cm9rZS1saW5lY2FwPSJzcXVhcmUiIGZpbGw9Im5vbmUiLz48cGF0aCBkPSJNMS44ODMgMy45NTZsLjQzMi0uMzk3LjM0LS4zMjdxLjMwMi0uMjg2LjQtLjQ5NS4wOTgtLjIxLjA5OC0uNDQ4IDAtLjI2Ny0uMTExLS40MjItLjEwOC0uMTU2LS4zMTgtLjE1Ni0uMTUyIDAtLjI4Ni4wODMtLjEzLjA3OS0uMTMuMTcxIDAgLjE1Mi4xNjUuMTUyLjEyMSAwIC4xOTQuMDczLjA3Ni4wNy4wNzYuMTg0IDAgLjE0My0uMDk4LjIzOHQtLjI0MS4wOTVxLS4xNzggMC0uMjk1LS4xMDItLjExNy0uMTA1LS4xMTctLjI3MyAwLS4xOTcuMTMzLS4zNTYuMTMzLS4xNjIuMjk4LS4yMzUuMTY4LS4wNzMuMjk1LS4wOTJsLjI3Ni0uMDIycS4zODQgMCAuNjU0LjE3MXQuMjcuNDk1cTAgLjIwMy0uMTI3LjM2Mi0uMTI0LjE1OS0uMjc5LjI0MS0uMTU2LjA3OS0uNDc5LjIwNi0uMzIxLjEyNC0uMzU2LjE4MXYuMDEzbC4xODEtLjAxLjIyMi0uMDAzaC41MDJxLjE1NiAwIC4yMTktLjAzOGwuMDkyLS4xMDguMDUxLS4xMzcuMDM4LS4xMTFoLjA0MWwtLjIwMyAxLjA4NmgtMS45Mzd6IiBzdHlsZT0ibGluZS1oZWlnaHQ6MS4yNTstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOkVsZXBoYW50IiBmb250LXNpemU9IjMuMTc1IiBmb250LWZhbWlseT0iRWxlcGhhbnQiLz48L2c+PC9zdmc+" type="image/svg+xml">
    <meta property="og:title" content="s²">
    <meta property="og:description" content="s² is a function for reactive web UI." />
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://gr0uch.github.io/s2/s2.png">
    <meta property="og:image:type" content="image/png">
    <style type="text/css">
      :root {
        --w: 30;
        --wm: calc(var(--w) * 3 / 2);
        /*--wm: 100vw;*/
        --c: 7;

        --h: 17px;
        --l: calc(1em * 8 / 5);

        --b: calc(1 / 4);
        --o: calc(var(--b) * 3);

        --f-h: Garamond, Big Caslon Medium, Palatino Linotype, Palatino, serif;
        --f-b: -apple-system, BlinkMacSystemFont, Microsoft Sans Serif, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji;
        --f-m: SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;

        --c-bg: rgb(240, 240, 240);
        --c-fg: #000;
        --c-b: rgba(0, 0, 0, 0);
        --c-a: rgb(240, 240, 240);
        --c-a2: rgba(235, 235, 235, 0.75);
        --c-a3: rgb(225, 225, 225);
        --c-j: #f1e05a;
        --c-l: #3fb68b;
        --c-l2: rgba(63, 182, 138, 0.2);
        --c-h: #e34c26;
        --c-e: #6e40c9;
        --c-e2: rgba(110, 64, 201, 0.2);
        --c-e3: rgba(110, 64, 201, 0.1);
      }
      ::selection { background: var(--c-j); color: var(--c-fg); }
      * { margin: 0; padding: 0; border: 0; box-sizing: border-box; }
      body { font-size: var(--h); line-height: var(--l); background: var(--c-bg); color: var(--c-fg); font-family: var(--f-b); }
      h1, h2, h3, h4, h5, h6 { font-size: inherit; line-height: inherit; font-weight: inherit; hyphens: auto; }
      h1 { font-size: 3em; line-height: var(--l); font-family: var(--f-h); }
      h2 { font-size: calc(1em * 5 / 2); line-height: calc(var(--l) * 5 / 6); font-family: var(--f-h); }
      h3 { font-family: var(--f-h); font-weight: bold; margin-bottom: calc(var(--l) * 1); font-size: calc(1em * 5 / 4); }
      code { font-family: var(--f-m); font-size: 0.8em; }
      ul, ol { padding-left: var(--l); }
      p, ul, ol { margin-bottom: calc(var(--l) * 1); letter-spacing: 0.02em; hyphens: auto; }
      u.l { text-decoration-color: var(--c-l); }
      u.h { text-decoration-color: var(--c-h); }
      u.j { text-decoration-color: var(--c-j); }
      u.e { text-decoration-color: var(--c-e); }
      a { color: inherit; text-decoration-color: var(--c-l); text-decoration-thickness: calc(var(--h) * var(--b) * var(--o)); font-weight: bold; letter-spacing: 0; }

      /* box frame */
      .box-wrapper { position: fixed; z-index: 1; pointer-events: none; width: 100%; height: 100%; top: 0; left: 0; padding: calc(var(--l) * 3 / 4); }
      .box { border: calc(var(--l) * var(--b)) var(--c-b) solid; display: flex; height: 100%; width: 100%; }
      .box > header { border-right: calc(var(--l) * var(--b)) var(--c-b) solid; flex: 1; display: flex; pointer-events: auto; }
      .box > header > div { flex: 1; margin-top: calc(var(--l) * 13 / 3); }
      .box > header > div > * { /*background: var(--c-fg);*/ color: var(--c-bg); width: calc(var(--l) * 2 / 2); height: calc(var(--l) * 2 / 2); border-radius: 50%; margin: auto; display: flex; align-items: center; justify-content: center; font-weight: bold; user-select: none; }
      .box > header > div svg { display: block; height: 100%; width: 100%; }
      .box > div { flex: calc(var(--c) - 1); display: flex; }
      .box > div > div { border-top: calc(var(--l) * var(--b)) var(--c-fg) solid; padding: calc(var(--l) * var(--b)); flex: 1; align-self: flex-end; background: var(--c-a2); pointer-events: auto; display: flex; justify-content: space-between; }
      .box > div > div > * { margin: 0; }
      .box > div > div > *:last-child { text-align: right; }

      /* content */
      .container { padding: 0 calc(var(--l) * 3 / 4); }
      .container.top { background: var(--c-a3) /*url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAzNy4wNDIgNS4yOTIiPjxwYXRoIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiNmMGYwZjA7c3Ryb2tlLXdpZHRoOi43MTQxMjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgZD0iTTAgNC42MDRjOS4yNiAwIDkuMjYtMy45MTYgMTguNTItMy45MTYgOS4yNjEgMCA5LjI2MSAzLjkxNiAxOC41MjIgMy45MTYiLz48L3N2Zz4=) center -10px repeat*/; }
      .container.top > article { border: 1px var(--c-a3) solid; border-bottom: 0; }
      .container.content { padding-bottom: calc(var(--l) * 3 / 4); }
      .container.content > article { padding-top: calc(var(--l) * 6); border: 1px var(--c-a3) solid; border-top: 0; }
      article { display: flex; flex-direction: column; }
      article, .box { max-width: calc(var(--l) * var(--wm)); margin: auto; }
      article > header, article > section { padding: 0 calc(var(--l) * 1) 0 calc((100% - var(--l) * 2) / var(--c) + var(--l) * 9 / 8); }
      article > header > div, article > section > div { margin: auto; padding: 0 calc(var(--l) * 3 / 2); max-width: calc(var(--l) * var(--w)); }
      article > header { background: var(--c-a); }
      article > hr { height: calc(var(--l) * 3 / 4); background: var(--c-a3) /*url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAzNy4wNDIgNS4yOTIiPjxwYXRoIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiNmMGYwZjA7c3Ryb2tlLXdpZHRoOi43MTQxMjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgZD0iTTAgNC42MDRjOS4yNiAwIDkuMjYtMy45MTYgMTguNTItMy45MTYgOS4yNjEgMCA5LjI2MSAzLjkxNiAxOC41MjIgMy45MTYiLz48L3N2Zz4=) center -10px repeat*/; position: sticky; top: 0; }
      article > header > div > * { position: relative; }
      article > header > div > *:first-child { padding: calc(var(--l) * 2) 0 calc(var(--l) * 3); }
      article > section { margin: calc(var(--l) * 2) 0; }
      article > section > div > *:last-child { margin-bottom: 0; }
      article > section:last-of-type { margin-bottom: calc(var(--l) * 7); }

      /* bigword */
      figure { margin: calc(var(--l) * 3) 0; text-align: center; }
      .bigword { position: relative; height: calc(var(--l) * 1); display: inline-block; z-index: 0; white-space: nowrap; user-select: none; }
      .bigword > * { font-weight: inherit; position: absolute; top: 0; left: 0; color: transparent; font-size: calc(1em * 4); letter-spacing: 0.04em; -webkit-text-stroke-width: calc(var(--h) * var(--b) / 3); text-stroke-width: calc(var(--h) * var(--b) / 3); text-transform: inherit; }
      .bigword > *:nth-child(1) { position: relative; -webkit-text-stroke-color: var(--c-fg); text-stroke-color: var(--c-fg); top: calc(var(--l) * var(--o) * -0.3); left: calc(var(--l) * var(--o) * -0.3); z-index: 4; }
      .bigword > *:nth-child(2) { -webkit-text-stroke-color: var(--c-e); text-stroke-color: var(--c-e); top: calc(var(--l) * var(--o) * -0.1); left: calc(var(--l) * var(--o) * -0.1); z-index: 3; }
      .bigword > *:nth-child(3) { -webkit-text-stroke-color: var(--c-h); text-stroke-color: var(--c-h); top: calc(var(--l) * var(--o) * 0.1); left: calc(var(--l) * var(--o) * 0.1); z-index: 2; }
      .bigword > *:nth-child(4) { -webkit-text-stroke-color: var(--c-j); text-stroke-color: var(--c-j); top: calc(var(--l) * var(--o) * 0.3); left: calc(var(--l) * var(--o) * 0.3); z-index: 1; }

      /* demo */
      #demo { position: relative; top: calc(var(--l) * 2); margin-top: calc(var(--l) * -6); display: flex; }
      #demo *::selection { background: var(--c-h); color: var(--c-bg); }
      #demo > * { flex: 4; display: flex; flex-direction: column; border: calc(var(--l) * var(--b)) var(--c-b) solid; background: var(--c-bg); margin-right: calc(var(--l) * var(--b)); box-shadow: 0 calc(var(--l) / 4) calc(var(--l) / 2) var(--c-a3); }
      #demo > * > h4 { background: var(--c-bg); }
      /*#demo > *:nth-child(2) > h4 { background: var(--c-l); }*/
      #demo > *:nth-child(2) textarea { scrollbar-color: var(--c-l) var(--c-a); }
      #demo > * > * { padding: calc(var(--l) * var(--b)); }
      #demo textarea { font-family: var(--f-m); font-size: calc(var(--h) - 6px); scrollbar-color: var(--c-j) var(--c-a); scrollbar-width: thin; width: 100%; flex: 1; resize: none; background: var(--c-bg); }
      #demo textarea:focus { outline: none; }
      #demo > *:last-child { flex: 3; display: block; background: var(--c-e); margin-right: 0; }
      #demo input, #demo textarea { color: inherit; }
      #demo input { background: none; }
      #demo h1 { font-size: inherit; font-family: inherit; }

      /* container */
      #container form { padding-top: 0; }
      #container input, #container button { font-family: inherit; font-size: inherit; line-height: inherit; color: inherit; display: inline-block; width: 70%; border-radius: 0; }
      #container input:focus { outline: none; }
      #container input::placeholder { color: var(--c-fg); opacity: 0.4; }
      #container button { width: 30%; display: inline-block; text-align: center; background: var(--c-l); color: var(--c-bg); cursor: pointer; }
      #container input, #container button { border-bottom: 1px var(--c-fg) solid; }
      #container > ul { list-style-type: none; margin: 0; }
      #container > ul > li > div { cursor: pointer; display: inline-block; float: right; user-select: none; color: var(--c-h); }

      /* responsive */
      @media (max-width: 1024px) {
        .box { flex-direction: column; }
        .box > header { border: 0; flex: 0; padding-top: calc(var(--h) * 1); background: none; }
        .box > div { flex: 1; }
        .box > header > div { margin-top: 0; }
        .box > header > div > * { width: calc(var(--l) * 3 / 4); height: calc(var(--l) * 3 / 4); }
        article > header, article > section { padding-left: calc(var(--l) * 1); }
        #demo > * { flex: 1; }
        #demo > *:last-child { flex: 1; }
      }
      @media (max-width: 640px) {
        :root {
          --h: 14px;
        }
        h1 { font-size: calc(1em * 2); line-height: var(--l); }
        h2 { font-size: calc(1em * 3 / 2); line-height: calc(var(--l) * 5 / 6); }
        #demo > *:last-child { flex: 2; }
        figure { margin: calc(var(--l) * 2) 0; }
        .bigword > * { font-size: calc(1em * 5 / 2); }
        article > header > div, article > section > div { padding: 0; }
        article > header > div > *:first-child { padding: calc(var(--l) * 7 / 2) 0; }
        #computed-demo { flex-direction: column; }
        #computed-demo > :first-child { margin-right: 0 !important; }
      }
    </style>
  </head>
  <body>
    <div class="box-wrapper">
      <div class="box">
        <header>
          <div>
            <h1>
              <!--s&sup2;-->
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 4.2333333 4.2333333"><g><path fill="#3fb68b" fill-rule="evenodd" d="M0 0h4.233v4.233h-4.233z"/><path d="M1.416.831q-.403.3-.403.646 0 .444.32.444.114 0 .362-.196t.486-.196q.227 0 .367.119.14.114.14.305 0 .181-.181.382-.181.196-.641.45-.46.248-.584.331-.124.088-.212.212l-.026-.031.031-.062.036-.078-.088-.103q-.083-.078-.222-.078-.258 0-.408.269l-.026.031-.031-.031q0-.083.233-.32.238-.243.563-.243.243 0 .424.155l.041.026.072-.041q.346-.181.444-.331.098-.15.098-.315 0-.181-.109-.284-.103-.109-.274-.109-.124 0-.377.196-.248.196-.46.196-.165 0-.284-.129-.119-.134-.119-.315 0-.258.227-.517.227-.258.816-.568.289-.155.403-.326l.016-.021.021.041-.093.124-.088.124q.171.145.279.145.134 0 .284-.103l.021.031q0 .026-.243.243-.238.212-.372.212-.124 0-.444-.284z" style="line-height:1.25;-inkscape-font-specification:Parchment;paint-order:normal" font-size="10.583" font-family="Parchment" stroke="#fff" stroke-width=".132" stroke-linecap="square" fill="none"/><path d="M1.883 3.956l.432-.397.34-.327q.302-.286.4-.495.098-.21.098-.448 0-.267-.111-.422-.108-.156-.318-.156-.152 0-.286.083-.13.079-.13.171 0 .152.165.152.121 0 .194.073.076.07.076.184 0 .143-.098.238t-.241.095q-.178 0-.295-.102-.117-.105-.117-.273 0-.197.133-.356.133-.162.298-.235.168-.073.295-.092l.276-.022q.384 0 .654.171t.27.495q0 .203-.127.362-.124.159-.279.241-.156.079-.479.206-.321.124-.356.181v.013l.181-.01.222-.003h.502q.156 0 .219-.038l.092-.108.051-.137.038-.111h.041l-.203 1.086h-1.937z" style="line-height:1.25;-inkscape-font-specification:Elephant" font-size="3.175" font-family="Elephant"/></g></svg>
            </h1>
          </div>
        </header>
        <div>
          <!--<div>
            <div>
              &copy;
            </div>
            <div>
              See the code on <a href="https://github.com/gr0uch/s2">GitHub</a>.
            </div>
          </div>-->
        </div>
      </div>
    </div>
    <div class="container top">
      <article>
        <hr>
        <header>
          <div>
            <h2><strong>s&sup2;</strong> is a function for reactive web UI.<br><br><em>Input &larr;</em> <u class="j"><code>Object</code></u>, <u class="l"><code>&lt;template&gt;</code></u><br><em>Output &rarr;</em> <u class="h"><code>Proxy</code></u>, <u class="e"><code>DocumentFragment</code></u></h2>
            <div id="demo">
              <div>
                <h4>JS</h4>
                <textarea id="js" spellcheck="false">window.state = {
  todos: [
    'Sleep',
    'Wake up',
    'Get out of bed',
    'Brush teeth',
    'Get dressed',
  ].map(todo =>
    ({ todo, remove })),
  add,
};

// try uncommenting!
// state.todos.reverse()
// state.todos.splice(2, 1)
// state.todos.shift()
// state.todos.pop()

function remove() {
  const { todos } = proxy;
  const i = todos
    .findIndex(_ => _ === this);
  todos.splice(i, 1);
}

function add(event) {
  event.preventDefault();
  const { todo } = this;
  if (!todo) return;
  proxy.todos
    .unshift({ remove, todo });
  delete this.todo;
}
</textarea>
              </div>
              <div>
                <h4>HTML + Mustache</h4>
                <textarea id="templates" spellcheck="false"><template id="todos">
  <h1>Todos</h1>
  <form onsubmit="{{add}}">
    <input
      value="{{todo}}"
      placeholder="Todo...">
    <button>Add</button>
  </form>
  <ul>
    {{#todos}}
      <li>
        <div onclick="{{remove}}">
          &#x2715;
        </div>
        <span>{{todo}}</span>
      </li>
    {{/todos}}
  </ul>
</template>
</textarea>
              </div>
              <div id="container"><noscript>JS required!</noscript></div>
            </div>
          </div>
        </header>
      </article>
    </div>
    <div class="container content">
      <article>
        <section>
          <div>
            <h3>Rationale</h3>
            <p>The goal of <strong>s&sup2;</strong> is to provide a low overhead abstraction of UI state with as little API as possible.</p>
            <ul>
              <li>The main function is the only function required. Using it beyond that is as simple as using fundamental JavaScript operations and array/object methods.</li>
              <li>Templates are <em>logic-less</em>. This differs from prior art such as JSX where embedded JavaScript is allowed. Due to this constraint, logic-less templating such as <a href="https://mustache.github.io/">Mustache</a> maps well to <strong>s&sup2;</strong>, and there is an optional addon for context-aware Mustache templates.</li>
              <li>Optimize for different paradigms, mutable/immutable state should work equally well. Performance benchmarks should be <a href="https://krausest.github.io/js-framework-benchmark/current.html">excellent</a>.</li>
            </ul>
          </div>
        </section>
        <section>
          <div>
            <h3>How It Works</h3>
            <figure>
              <div class="bigword">
                <h3>new Proxy()</h3>
                <h3>new Proxy()</h3>
                <h3>new Proxy()</h3>
                <h3>new Proxy()</h3>
              </div>
            </figure>
            <p><strong>s&sup2;</strong> makes extensive use of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy</a> objects. Internally, these proxies are mapped to DOM elements using a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap">WeakMap</a>, which makes it <a href="https://www.stefankrause.net/wp/?p=342">keyed</a>. It turns objects into proxies recursively, so that deeply nested data structures are reactive.</p>
            <p>The consequence of using proxies instead of a traditional API with method calls, is that <em>UI code disappears, it is folded into the data</em>.</p>
          </div>
        </section>
        <section>
          <div>
            <h3>Templating</h3>
            <p>By default, there are <code>data-</code> attribute keywords it will look for, but using the <a href="https://github.com/gr0uch/s2/blob/master/src/mustache.lisp">Mustache addon</a> may be preferred. This will convert a subset of Mustache into the data attribute format it expects, with some caveats:</p>
            <ul>
              <li>Inverted sections are not supported. This won&apos;t work: <code>{{^section}}{{/section}}</code></li>
              <li>Partials can only exist as the only child of a section. For example, <code>{{#section}}{{>partial}}{{/section}}</code>.</li>
              <li>String interpolation is not allowed in attributes. This won&apos;t work: <code>&lt;p style="color: #{{hex}};"&gt;</code>, but this will: <code>&lt;p style="{{style}}"&gt;</code>.</li>
            </ul>
            <p>By being aware of the HTML context, this subset of Mustache performs very well and incurs no performance penalty on rendering, unlike prior art which relied on setting <code>innerHTML</code>.</p>
          </div>
        </section>
        <section>
          <div>
            <h3>Computed Properties</h3>
            <p>Computed properties are an <a href="https://github.com/gr0uch/s2/blob/master/src/computed-properties.lisp">optional addon</a>. It adds automatic dependency tracking by using the <code>get</code> trap, which makes non-local objects reactive. This is mainly an ergonomic feature so that properties that should be propagated in multiple places are updated automatically.</p>
            <style>
              #computed-demo { display: flex; align-items: center; margin: var(--l) 0; }
              #computed-demo > :first-child { flex: 1; color: var(--c-e); padding: calc(var(--l) / 4); margin: calc(var(--l) / 4) var(--l) calc(var(--l) / 4) 0; box-shadow: 0 calc(var(--l) / 4) calc(var(--l) / 2) var(--c-e2); }
              #computed-demo > :last-child { flex: 2; display: flex; flex-direction: column; }
              #computed-demo > :last-child > * { display: flex; padding: calc(var(--l) / 4) 0; margin: calc(var(--l) / 2) 0; box-shadow: 0 calc(var(--l) / 4) calc(var(--l) / 2) var(--c-a3); }
              #computed-demo > :last-child > * > * { flex: 1; padding: 0 calc(var(--l) / 4); }
              #computed-demo label { display: flex; }
              #computed-demo label > * { flex: 1; }
              #computed-demo input { border-bottom: 1px var(--c-a3) solid; margin: 0 calc(var(--l) / 2); font-family: inherit; font-size: inherit; color: inherit; background: none; width: calc(var(--l) * 2); border-radius: 0; }
              #computed-demo input:focus { outline: none; }
              #computed-demo .computed-value { margin: 0 calc(var(--l) / 6); font-weight: bold; }
              #computed-demo code { background: var(--c-e3); border-radius: calc(var(--l) / 6); padding: 0 calc(var(--l) / 8); }
            </style>
            <template id="computed">
              <div>
                Formula: <code>value * scalar</code>
                <label>
                  Scalar: <input type="number" data-value="scalar" data-event-input="scalarInput" step="0.1">
                </label>
              </div>
              <div>
                <slot name="values" data-template="#value"></slot>
              </div>
            </template>
            <template id="value">
              <div>
                <div>
                  <label>
                    Value: <input type="number" data-value="value" data-event-input="valueInput" step="0.1">
                  </label>
                </div>
                <div>
                  <label>
                    Computed: <span class="computed-value" data-text="computedValue"></span>
                  </label>
                </div>
              </div>
            </template>
            <div id="computed-demo">
            </div>
            <p>In the above demo, the source object which contains the scalar value does not need to know about its dependents. When it updates, the hidden dependency tracking will update the dependent computed properties.</p>
          </div>
        </section>
        <section>
          <div>
            <h3>Animations with FLIP</h3>
            <p><a href="https://aerotwist.com/blog/flip-your-animations/">FLIP</a> is an animation technique that stands for First, Last, Invert, Play. The <code>move</code> symbol lets the developer implement smooth transitions.</p>
            <style>
              #flip-demo { display: flex; justify-content: center; }
              #flip-demo > * { margin: 0 calc(var(--l) / 5); padding: calc(var(--l) / 12) calc(var(--l) / 3); box-shadow: 0 calc(var(--l) / 4) calc(var(--l) / 2) var(--c-a3); background: var(--c-bg); }
              #flip-demo .shuffle { color: var(--c-l); user-select: none; cursor: pointer; box-shadow: 0 calc(var(--l) / 4) calc(var(--l) / 2) var(--c-l2); }
              @media (max-width: 640px) {
                  #flip-demo > * { margin: 0 2px; padding: 1px 5px; }
              }
            </style>
            <template id="flip">
              <slot name="flippers" data-template="#flipper"></slot>
              <div class="shuffle" data-event-click="shuffle">Shuffle</div>
            </template>
            <template id="flipper">
              <div data-text="text"></div>
            </template>
            <div id="flip-demo"></div>
          </div>
        </section>
        <section>
          <div>
            <h3>Further Reading</h3>
            <p>Check out the <a href="https://github.com/gr0uch/s2">GitHub repository</a> for technical details.</p>
          </div>
        </section>
      </article>
    </div>
    <script defer>
      (async global => {
        const [
            { default: depCheck },
            { default: s2, mount: s2mount, unmount: s2unmount, move: s2move },
            { createSource, createComputed },
            { default: parseMustache },
        ] = await Promise.all([
          import('./dep-check.min.mjs'),
          import('./main.min.mjs'),
          import('./computed-properties.min.mjs'),
          import('./mustache.min.mjs'),
        ]);
        // s2.debug = true;

        const container = document.getElementById('container');
        if (!depCheck()) {
          const notice = document.createElement('div');
          notice.textContent =
            'This browser environment does not contain all of the required APIs.';
          container.appendChild(notice);
          return;
        }

        const js = document.getElementById('js');
        const templates = document.getElementById('templates');
        const tmp = document.createElement('div');
        tmp.id = 'tmp';
        document.body.appendChild(tmp);

        js.addEventListener('input', mount);
        templates.addEventListener('input', mount);

        function mount() {
          const start = performance.now();
          eval(js.value);
          tmp.innerHTML = templates.value;
          cleanupTemplates();
          const root = document.getElementById('todos');
          parseMustache(root);
          const [proxy, node] = s2(global.state, root);
          while (container.firstChild) container.firstChild.remove();
          container.appendChild(node);
          global.proxy = proxy;
          console.info(`\`mount\` called in ${performance.now() - start}ms`);
        }

        const computed = createComputed(s2mount, s2unmount);
        const sourceContext = createSource({
          scalar: 1.2,
        });

        function computedValue(value) {
          const source = createSource({ value });
          return computed({
            source,
            value,
            valueInput,
            computedValue() {
              return (this.source.value * sourceContext.scalar).toFixed(2);
            },
          });
        }

        function scalarInput(event) {
          const { target: { value } } = event;
          sourceContext.scalar = Number(value);
        }

        function valueInput(event) {
          const { target: { value } } = event;
          this.source.value = Number(value);
        }

        function mountComputed() {
          const v1 = computedValue(2.5);
          const v2 = computedValue(4);
          const state = Object.assign({
            scalarInput,
            values: [
              v1,
              v2,
            ],
          }, sourceContext);
          const root = document.getElementById('computed');
          const [proxy, node] = s2(state, root);
          const container = document.getElementById('computed-demo');
          container.appendChild(node);
          global.s = sourceContext;
        }

        function mountFLIP() {
          function move(node) {
            if (this.isMoving) return;
            this.isMoving = true;
            const first = node.getBoundingClientRect();
            requestAnimationFrame(() => {
              delete this.isMoving;
              const last = node.getBoundingClientRect();
              const invert = first.left - last.left;
              node.animate([
                { transform: `translateX(${invert}px)` },
                { transform: 'translateX(0)' },
              ], {
                duration: 250,
                easing: 'ease-in-out',
              });
            });
          }
          function shuffle() {
            const array = this.flippers;
            array.sort((a, b) => Math.random() < 0.5 ? -1 : 1);
          }
          const state = {
            flippers: new Array(9).fill().map((_, i) => {
              return {
                text: i + 1,
                [s2move]: move,
              };
            }),
            shuffle,
          };
          const root = document.getElementById('flip');
          const [proxy, node] = s2(state, root);
          const container = document.getElementById('flip-demo');
          container.appendChild(node);
        }

        function cleanupTemplates() {
          document.querySelectorAll('template').forEach(template => {
            const iter = document
              .createNodeIterator(template.content, NodeFilter.SHOW_TEXT);
            let node;
            while (node = iter.nextNode()) {
              if (!node.nodeValue.trim().length)
                node.remove();
            }
          });
        }

        cleanupTemplates();
        mount();
        mountComputed();
        mountFLIP();

        // One layout trick requires JS...
        const hr = document.querySelector('article > hr');
        const top = document.querySelector('.container.top');
        window.addEventListener('scroll', setBG, { passive: true });
        function setBG() {
          const limit = top.clientHeight - hr.clientHeight;
          const value = `${-Math.min(limit, document.documentElement.scrollTop) - 10}px`;
          hr.style.backgroundPositionY = value;
        }
        setBG();
      })(this);
    </script>
  </body>
</html>
