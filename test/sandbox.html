<!DOCTYPE html>
<meta charset="utf-8">
<title>s2 sandbox</title>
<script type="module">
  import s2, { mount, unmount, registerTemplate } from "../dist/main.mjs";
  import { createComputed, observable } from "../dist/computed-properties.mjs";
  import { createMustacheTag } from "../dist/mustache.mjs";

  const mustache = createMustacheTag(registerTemplate);
  const computed = createComputed(mount, unmount);

  const s = observable({
    // foos: null,
    foos: ["a", "b"],
  }, true);

  window.s = s;

  const comp = mustache`
<div>
  {{#nest}}
    <span>
      {{text}}
    </span>
  {{/nest}}
</div>
`;

  const template = mustache`
<button onclick="{{delete}}">delete</button>
{{#comp}}
  ${comp}
{{/comp}}
`;

  const [reactiveObject, node] = s2({
    delete(event) {
      event.preventDefault();
      // s.foos.length = s.foos.length - 1;
      delete s.foos;
    },
    comp: computed({
      nest() {
        const { foos } = s;
        if (!foos) return null;
        return foos.map((_, i) => {
          return computed({
            i,
            text() {
              const { foos } = s;
              const value = foos[i];
              if (typeof value !== "object") return value;
              return value.foo;
            },
          });
        });
      },
    }),
  }, template);

  document.body.appendChild(node);

  // s.foos = ["a", "b"];
</script>
